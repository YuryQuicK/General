; 2022 ОТИ МИФИ
; Учебная группа 1ПО-49Д
; Дисциплина: Программирование микроконтроллеров
; Микроконтроллер: учебный стенд SDK 1.1
;

$Mod812 ; включаем файл, содержащий символы микроконтроллера
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
; здесь располагаются символы, определяемые программистом


; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        LJMP START ; переход на начало программы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        
        ; здесь располагаются обработчики прерываний
        
        
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        ORG 80h ; адрес начала программы
START:  ; метка начала программы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;

        ; здесь располагаются инструкции алгоритма программы
        ; иначе говоря, основной код пишем здесь !!!

	; записываем в DPTR адрес регистра светодиодов
        MOV DPL,#7
        MOV DPH,#0
        MOV DPP,#8

	MOV A,#255
	MOVX @DPTR,A

CYCLE:
	MOV DPL,#0
	MOV R0,A

	MOV A,#0FDh
	MOVX @DPTR,A

	LCALL PUSH_KEY
	LCALL RELEASE_KEY

	MOV A,R0
	MOV DPL,#7

	MOV B,#2
	DIV AB
	MOVX @DPTR,A

	JNZ CYCLE

	MOV DPL,#0
	LCALL PUSH_KEY
	LCALL RELEASE_KEY

	SJMP START
        
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        SJMP $ ; замкнутый бесконечный цикл
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;

        ; XXXXXX - ПОДПРОГРАММЫ - XXXXXX ;

PUSH_KEY:
	MOVX A,@DPTR
	ANL A,#020h
	JNZ PUSH_KEY

RELEASE_KEY:
	MOVX A,@DPTR
	ANL A,#020h
	JZ RELEASE_KEY

; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
; подпрограмма задержки на 250000 мкс
D250:

        RET ; обязательный признак завершения подпрограммы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        END ; обязательный признак завершения текста
