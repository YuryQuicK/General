; 2022 ОТИ МИФИ
; Учебная группа 1ПО-49Д
; Дисциплина: Программирование микроконтроллеров
; Микроконтроллер: учебный стенд SDK 1.1
;

$Mod812 ; включаем файл, содержащий символы микроконтроллера
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
; здесь располагаются символы, определяемые программистом


; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        LJMP START ; переход на начало программы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        
        ; здесь располагаются обработчики прерываний
        
        
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        ORG 80h ; адрес начала программы
START:  ; метка начала программы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;

        ; здесь располагаются инструкции алгоритма программы
        ; иначе говоря, основной код пишем здесь !!!

	; записываем в DPTR адрес регистра светодиодов
        MOV DPL,#7
        MOV DPH,#0
        MOV DPP,#8

	MOV A,#255
	MOVX @DPTR,A

CYCLE:
	MOV DPL,#0

	MOV R0,A

	MOV A,#0F0h
	MOVX @DPTR,A

PUSH_KEY:
	MOVX A,@DPTR
	SUBB A,#0F0h
	JZ PUSH_KEY

	MOV A,R0
	MOV DPL,#7

	MOV B,#2
	DIV AB
	MOVX @DPTR,A

	LCALL DELAY251

	JNZ CYCLE
	SJMP START
        
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        SJMP $ ; замкнутый бесконечный цикл
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;

        ; XXXXXX - ПОДПРОГРАММЫ - XXXXXX ;

; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
; подпрограмма задержки на 250000 мкс
D250:

DELAY251:
    MOV     R2, #13
D4502:
    MOV     R1, #154
D4501:
    MOV     R0, #207
    DJNZ    R0, $
    DJNZ    R1, D4501
    DJNZ    R2, D4502
    RET

        RET ; обязательный признак завершения подпрограммы
; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ;
        END ; обязательный признак завершения текста
